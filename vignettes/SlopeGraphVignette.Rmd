---
title: "Revised/Improved Slope Graph"
author: "Rob Schick"
date: "29 January 2016"
output: word_document
---

```{r, setup, echo=FALSE, warning=FALSE, message=FALSE}
rm(list = ls())
set.seed(314)
library(ggplot2)
library(readr)
library(knitr)
library(dplyr)
```

# Data Simulation
## Population Data
The goal of this is to write a short simulation that generates data of health anomaly at three points:

1. The start of an entanglement window
2. The end of an entanglement window
3. 12 months after the end of the window

We are doing this in order to look at a different way of displaying the slope plots that show decline in health. So let's make some data:

```{r}
gearInj <- 1:6
gvec <- c('Severe Gear', 'Moderate Gear', 'Severe No Gear', 'Minor Gear', 'Moderate No Gear', 'Minor No Gear')
gvec <- factor(gvec, levels = c('Minor No Gear', 'Minor Gear', 'Moderate No Gear', 'Moderate Gear','Severe No Gear','Severe Gear'))
ncat <- length(gearInj)
num <- c(29, 19, 12, 18, 96, 341)

dat <- data.frame(gearInjury = gearInj,
                  gearLab = gvec,
                  numEvents = num)
dat
```

## Health Anomaly Data
That's the basic data about numbers, events, etc. Now we need to simulate health anomaly data. To build this data base, I'm going to make a few assumptions:

1. I'm going to assume the anomalies from start to end increase as the severity increases
2. I'm going to assume the anomalies from end to recovery decrease as the severity decreases, i.e. animals with more severe entanglements are less likely to recover
3. I'm going to assume smaller variance as `num` increases

So the pseudocode for the simulation is as follows: 

1. go through each entanglement category, `i`
2. prepare a data frame with 7 columns where `nrows == num[i]` 
3. Draw `num[i]` starting values
4. Draw `num[i]` ending values
5. Draw `num[i]` recovery values

The data will look like this:

EGNo | Ent ID | gearInjury | gearLab | Start | End | Recover 
-----|----|----|----|----|----|----|----
1014 | 1 | 1 | Severe Gear | 0.05 | -15 | -13 
2320 | 3 | 4 | Minor Gear | 1 | -3 | 0.0

Now we'll build a few things in `R`. First we initialise and partially fill a data frame to hold the simulated values.

```{r}
hdat <- data.frame(EGNo = floor(runif(n = sum(num), min = 1004, max = 3000)),
                   EntID = sample(1:4, size = sum(num), replace = TRUE),
                   gearInjury = rep(dat$gearInjury, times = dat$numEvents),
                   gearlab = rep(dat$gearLab, times = dat$numEvents),
                   shAnom = rnorm(sum(num), sd = 2))
head(hdat)
```

Now we'll have to add in the simulated values for end health anomaly and recovery health anomaly as a function of entanglement injury.

```{r}
hdat$ehAnom <- c(rnorm(n = dat$numEvents[1], mean = -15),
                 rnorm(n = dat$numEvents[2], mean = -12.5),
                 rnorm(n = dat$numEvents[3], mean = -13),
                 rnorm(n = dat$numEvents[4], mean = -10),
                 rnorm(n = dat$numEvents[5], mean = -8),
                 rnorm(n = dat$numEvents[6], mean = -2))

hdat$rhAnom <- c(rnorm(n = dat$numEvents[1], mean = -15),
                 rnorm(n = dat$numEvents[2], mean = -7.5),
                 rnorm(n = dat$numEvents[3], mean = -13),
                 rnorm(n = dat$numEvents[4], mean = -1),
                 rnorm(n = dat$numEvents[5], mean = -2),
                 rnorm(n = dat$numEvents[6], mean = 0))
head(hdat)
```

## Slope Graph - Option 1
This one is similar to the last slope graph, but turns it on its head and displays the data from all the lines in addition to the summary line. By including all of the lines, we get a visual sense of the amount in each category.

```{r}
p <- ggplot(data = hdat)+
  geom_segment(aes(x = shAnom, xend = ehAnom, y = 2, yend = 1)) +
  geom_segment(aes(x = ehAnom, xend = rhAnom, y = 1, yend = 0))
p
```


